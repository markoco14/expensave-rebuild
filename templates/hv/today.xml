<doc xmlns="https://hyperview.org/hyperview">
    <screen>
        {% set percent_spent = (total_spent  /  daily_spending_bucket.daily_amount * 100) %}
        <styles>
            {% include "hv/styles/base.style.xml" %}
            {% include "hv/styles/purchases.style.xml" %}
        </styles>
        <body>
            <behavior trigger="refresh" action="reload" href="/hv/today"/>
            <view style="container">
                <behavior trigger="on-event" event-name="purchase-added" action="reload" href="/hv/today"/>
                {% if not daily_spending_bucket %}
                <text>You haven't set up your daily budget for this month.</text>
                <text>Click here to set your budget</text>
                {% else %}
                <text style="heading">{{ today_date.strftime("%B %d, %Y") }}</text>
                <view style="progress-track">
                    <view style="progress-bar">{% if percent_spent >= 50 %}<text>${{total_spent}}</text>{% endif %}</view>
                    {% if percent_spent <= 50 %}
                    <text>${{total_spent}}</text>
                    {% endif %}
                </view>
                {% endif %}
                <list>
                    <item>
                        <view style="btn-primary" action="press">
                            <behavior trigger="press" href="/hv/today/new"/>
                            <text style="btn-primary-text">Add purchase</text>
                        </view>
                    </item>
                    {% for purchase in purchases %}
                    <item key="{{ loop.index0 }}" style="list-item">
                        <text style="list-item-text">{{ purchase.purchased_at.strftime("%b %d") }}</text>
                        <text style="list-item-text">${{ purchase.amount }} in {{ purchase.bucket_name }}</text>
                        <text style="list-item-text">Details</text>
                    </item>
                    {% endfor %}
                </list>
            </view>
        </body>
  </screen>
</doc>