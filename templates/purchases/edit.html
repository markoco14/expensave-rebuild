{% extends "base.html" %}

{% block title %}
Edit Purchase {{ purchase.purchase_id }} | The Money Game
{% endblock title %}

{% block content %}
<section class="wrapper">
    <h1 class="page-heading">Purchase {{ purchase.purchase_id }} <a href="/purchases/{{ purchase.purchase_id }}" class="heading-link">Back</a></h1>
    <hr />
    <br />
    <form hx-put="/purchases/{{ purchase.purchase_id }}" hx-swap="none">
        <div class="input-group">
            <label for="amount">Amount</label>
            <input id="amount" name="amount" type="text" value="{{ purchase.amount }}"/>
        </div>
        <div class="input-group">
            <label for="date">Date</label>
            <input id="date" name="date" type="date" value="{{ purchase.purchased_at.strftime('%Y-%m-%d') }}"/>
        </div>
        <div class="input-group">
            <label for="time">Time</label>
            <input id="time" name="time" type="time" value="{{ purchase.purchased_at.strftime('%H:%M:%S') }}"/>
        </div>
        <div class="input-group">
            <label for="timezone">Timezone</label>
            <input id="timezone" name="timezone" type="text" value="Asia/Taipei" readonly />
        </div>
         <fieldset>
            <legend>Spending Bucket</legend>
            <div class="radio-group">
                {% for bucket in buckets %}
                    <label>
                        <input 
                            type="radio"
                            name="bucket"
                            value="{{ bucket.bucket_id }}"
                            {% if previous_values and previous_values.get("bucket")|string == bucket.bucket_id|string %}
                                checked
                            {% elif purchase.bucket_id == bucket.bucket_id %}
                                checked
                            {% endif %}
                            />
                        <span class="card">{{ bucket.name }}</span>
                    </label>
                {% endfor %}
            </div>
            <span class="error">{{ errors.get("bucket", "") if errors else ''}}</span>
        </fieldset>
        <button type="submit">Update purchase</button>
    </form>
</section>
<hr class="divider"/>
<section class="wrapper danger-zone">
    <h2>Danger Zone</h2>
    <p>Press the button below to delete this purchase. Warning, you cannot undo this action.</p>
    <button 
        class="delete-btn"
        hx-delete="/purchases/{{ purchase.purchase_id }}"
        hx-confirm="Are you sure you want to delete this purchase? This action is permanent."
        >
        Delete purchase
    </button>
</section>
{% endblock content %}